<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importar Dados - Di√°rio de Sono</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f0e6; min-height: 100vh; padding: 2rem; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: #6b5b47; margin-bottom: 1rem; }
        .user-info { background: #f5f0e6; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        button { padding: 1rem 2rem; border: none; border-radius: 0.5rem; font-size: 1rem; cursor: pointer; margin: 0.5rem 0; width: 100%; }
        .btn-primary { background: #6b5b47; color: white; }
        .btn-danger { background: #d32f2f; color: white; }
        .btn-secondary { background: #e0d5c5; color: #333; }
        #log { background: #f5f5f5; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; }
        .hidden { display: none; }
        #auth-screen { text-align: center; padding: 3rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåô Importar Dados do Di√°rio</h1>
        
        <div id="auth-screen">
            <p>Fa√ßa login para importar dados:</p>
            <button id="google-login" class="btn-primary" style="margin-top: 1rem;">Entrar com Google</button>
        </div>
        
        <div id="import-screen" class="hidden">
            <div class="user-info">
                <span id="user-email"></span>
                <button id="logout" style="width: auto; padding: 0.5rem 1rem;">Sair</button>
            </div>
            
            <p style="margin-bottom: 1rem;">Este script importa os dados do di√°rio em papel (7-13 Janeiro 2026) para a sua conta.</p>
            
            <button id="delete-btn" class="btn-danger">üóëÔ∏è Apagar dados antigos (7-13 Jan)</button>
            <button id="import-btn" class="btn-primary">üì• Importar Dados</button>
            <button onclick="window.location.href='index.html'" class="btn-secondary">‚Üê Voltar √† App</button>
            
            <div id="log"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="config.js"></script>
    <script>
        const log = (msg) => { document.getElementById('log').textContent += msg + '\n'; };
        
        // Paper diary data - 7 to 13 January 2026 - EXACT format
        const PAPER_DATA = [
            {
                date: '2026-01-07',
                answers: {
                    acordou: '07:30',
                    levantou: '07:45',
                    como_sente_manha: 'Razoavelmente',
                    sestas: 'N√£o',
                    cafeina: '2 caf√©s/ch√°s',
                    cafeina_ultima_hora: '15:00',
                    atividade_fisica: 'Caminhada',
                    atividade_fisica_duracao: 30,
                    deitou: '23:30',
                    tempo_adormecer: 20,
                    vezes_acordou: '1',
                    despertares_oque: 'Fui √† casa de banho',
                    tempo_acordado_noite: 10,
                    sono_total: '7h 30min',
                    comprimidos: 'Nenhum',
                    alcool: 'N√£o bebi',
                    qualidade_noite: 'Bem'
                }
            },
            {
                date: '2026-01-08',
                answers: {
                    acordou: '08:00',
                    levantou: '08:15',
                    como_sente_manha: 'Bem',
                    sestas: 'N√£o',
                    cafeina: '3 caf√©s/ch√°s',
                    cafeina_ultima_hora: '16:00',
                    atividade_fisica: 'Gin√°sio',
                    atividade_fisica_duracao: 60,
                    deitou: '00:00',
                    tempo_adormecer: 15,
                    vezes_acordou: '0',
                    sono_total: '7h 45min',
                    comprimidos: 'Nenhum',
                    alcool: 'N√£o bebi',
                    qualidade_noite: 'Bem'
                }
            },
            {
                date: '2026-01-09',
                answers: {
                    acordou: '07:45',
                    levantou: '08:00',
                    como_sente_manha: 'Razoavelmente',
                    sestas: 'Sim',
                    sestas_duracao: 30,
                    cafeina: '2 caf√©s/ch√°s',
                    cafeina_ultima_hora: '14:00',
                    atividade_fisica: 'Nenhuma',
                    deitou: '23:45',
                    tempo_adormecer: 25,
                    vezes_acordou: '2',
                    despertares_oque: 'Fui √† casa de banho, olhei telem√≥vel',
                    tempo_acordado_noite: 20,
                    sono_total: '7h 00min',
                    comprimidos: 'Nenhum',
                    alcool: '1 bebida',
                    qualidade_noite: 'Razoavelmente'
                }
            },
            {
                date: '2026-01-10',
                answers: {
                    acordou: '09:00',
                    levantou: '09:30',
                    como_sente_manha: 'Bem',
                    sestas: 'N√£o',
                    cafeina: '1 caf√©/ch√°',
                    cafeina_ultima_hora: '10:00',
                    atividade_fisica: 'Caminhada',
                    atividade_fisica_duracao: 45,
                    deitou: '00:30',
                    tempo_adormecer: 10,
                    vezes_acordou: '0',
                    sono_total: '8h 15min',
                    comprimidos: 'Nenhum',
                    alcool: 'N√£o bebi',
                    qualidade_noite: 'Muito bem'
                }
            },
            {
                date: '2026-01-11',
                answers: {
                    acordou: '08:30',
                    levantou: '08:45',
                    como_sente_manha: 'Bem',
                    sestas: 'N√£o',
                    cafeina: '2 caf√©s/ch√°s',
                    cafeina_ultima_hora: '15:30',
                    atividade_fisica: 'Corrida',
                    atividade_fisica_duracao: 30,
                    deitou: '23:00',
                    tempo_adormecer: 15,
                    vezes_acordou: '1',
                    despertares_oque: 'Bebi √°gua',
                    tempo_acordado_noite: 5,
                    sono_total: '8h 00min',
                    comprimidos: 'Nenhum',
                    alcool: 'N√£o bebi',
                    qualidade_noite: 'Bem'
                }
            },
            {
                date: '2026-01-12',
                answers: {
                    acordou: '10:00',
                    levantou: '10:30',
                    como_sente_manha: 'Muito bem',
                    sestas: 'Sim',
                    sestas_duracao: 20,
                    cafeina: '3 caf√©s/ch√°s',
                    cafeina_ultima_hora: '17:00',
                    atividade_fisica: 'Nenhuma',
                    deitou: '01:00',
                    tempo_adormecer: 20,
                    vezes_acordou: '0',
                    sono_total: '8h 30min',
                    comprimidos: 'Nenhum',
                    alcool: '2 bebidas',
                    qualidade_noite: 'Bem'
                }
            },
            {
                date: '2026-01-13',
                answers: {
                    acordou: '08:15',
                    levantou: '08:30',
                    como_sente_manha: 'Razoavelmente',
                    sestas: 'N√£o',
                    cafeina: '2 caf√©s/ch√°s',
                    cafeina_ultima_hora: '14:30',
                    atividade_fisica: 'Caminhada',
                    atividade_fisica_duracao: 60,
                    deitou: '23:15',
                    tempo_adormecer: 30,
                    vezes_acordou: '2',
                    despertares_oque: 'Fiquei na cama a pensar',
                    tempo_acordado_noite: 25,
                    sono_total: '7h 15min',
                    comprimidos: 'Nenhum',
                    alcool: 'N√£o bebi',
                    qualidade_noite: 'Razoavelmente'
                }
            }
        ];
        
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('import-screen').classList.remove('hidden');
                document.getElementById('user-email').textContent = user.email;
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('import-screen').classList.add('hidden');
            }
        });
        
        document.getElementById('google-login').addEventListener('click', async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            await auth.signInWithPopup(provider);
        });
        
        document.getElementById('logout').addEventListener('click', () => auth.signOut());
        
        document.getElementById('delete-btn').addEventListener('click', async () => {
            if (!auth.currentUser) return;
            if (!confirm('Tem a certeza que quer apagar os dados de 7-13 Janeiro?')) return;
            
            document.getElementById('log').textContent = '';
            log('üóëÔ∏è A apagar dados antigos...\n');
            
            for (const entry of PAPER_DATA) {
                try {
                    await db.collection('users').doc(auth.currentUser.uid)
                        .collection('entries').doc(entry.date).delete();
                    log(`‚úÖ Apagado: ${entry.date}`);
                } catch (e) {
                    log(`‚ö†Ô∏è Erro ao apagar ${entry.date}: ${e.message}`);
                }
            }
            log('\n‚úÖ Dados apagados!');
        });
        
        document.getElementById('import-btn').addEventListener('click', async () => {
            if (!auth.currentUser) return;
            
            document.getElementById('log').textContent = '';
            log('üì• A importar dados do di√°rio em papel...\n');
            log(`Utilizador: ${auth.currentUser.email}\n`);
            
            for (const entry of PAPER_DATA) {
                try {
                    await db.collection('users').doc(auth.currentUser.uid)
                        .collection('entries').doc(entry.date).set({
                            date: entry.date,
                            answers: entry.answers,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            importedFrom: 'paper-diary'
                        });
                    log(`‚úÖ ${entry.date} importado`);
                } catch (e) {
                    log(`‚ùå Erro ${entry.date}: ${e.message}`);
                }
            }
            log('\nüéâ Importa√ß√£o conclu√≠da!');
            log('Pode voltar √† app para ver os dados.');
        });
    </script>
</body>
</html>
